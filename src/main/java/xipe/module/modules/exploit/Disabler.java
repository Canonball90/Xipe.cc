package xipe.module.modules.exploit;

import net.minecraft.network.packet.c2s.play.PlayerActionC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInputC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInteractEntityC2SPacket;
import net.minecraft.network.packet.s2c.play.KeepAliveS2CPacket;
import net.minecraft.network.packet.s2c.play.PlayerPositionLookS2CPacket;
import net.minecraft.util.Formatting;
import xipe.event.EventTarget;
import xipe.event.events.EventReceivePacket;
import xipe.event.events.EventSendPacket;
import xipe.mixins.PlayerInputC2SPacketAccessor;
import xipe.module.Mod;
import xipe.module.settings.ModeSetting;

public class Disabler extends Mod {

    public ModeSetting mode = new ModeSetting("Mode", "Position Packet", "Position Packet", "Verus");

    public Disabler() {
        super("Disabler", "Disables crappy anticheats", Category.EXPLOIT);
        addSettings(mode);
    }
    
    private static final Formatting Gray = Formatting.GRAY;

    @EventTarget
    public void onReceivePacket(EventReceivePacket event) {
        this.setDisplayName("Disabler" + Gray + "["+mode.getMode()+"]");
        System.out.println("packetreceived");
        if (mc.player != null && mc.world != null && mc.player.age <= 40) {
            if (event.getPacket() instanceof PlayerPositionLookS2CPacket && mode.getMode() == "Position Packet") {
                event.setCancelled(true);
            } else if (mode.getMode() == "Verus") {
//            	if (event.getPacket() instanceof S32PacketConfirmTransaction) {
//        			event.setCancelled(true);
//        		}
                if (event.getPacket() instanceof KeepAliveS2CPacket) {
                    event.setCancelled(true);
                }
            }
        }
    }

    @EventTarget
    public void onSendPacket(EventSendPacket event) {
        if (mode.getMode() == "Verus") {
            System.out.println("packetsent");
            if (event.getPacket() instanceof PlayerInteractEntityC2SPacket) {
                event.setCancelled(true);
            }
            if (event.getPacket() instanceof PlayerActionC2SPacket) {
                mc.player.networkHandler.sendPacket(new PlayerInputC2SPacket(0, 0, false, false));
            }
            if (event.getPacket() instanceof PlayerInputC2SPacket) {
                final PlayerInputC2SPacket packet = (PlayerInputC2SPacket)event.getPacket();
//                mc.player.networkHandler.sendPacket(new PlayerInputC2SPacket(Float.POSITIVE_INFINITY, Float.POSITIVE_INFINITY, mc.player.age % 2 == 0, mc.player.age % 2 != 0));
                ((PlayerInputC2SPacketAccessor)packet).setForward(Float.POSITIVE_INFINITY);
                ((PlayerInputC2SPacketAccessor)packet).setSideways(Float.POSITIVE_INFINITY);
                ((PlayerInputC2SPacketAccessor)packet).setJumping(mc.player.age % 2 == 0);
                ((PlayerInputC2SPacketAccessor)packet).setSneaking(mc.player.age % 2 != 0);
            }
        }
    }
}

