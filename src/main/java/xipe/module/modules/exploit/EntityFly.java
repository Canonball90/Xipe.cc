package xipe.module.modules.exploit;

import net.minecraft.entity.Entity;
import net.minecraft.util.math.Vec3d;
import xipe.module.Mod;
import xipe.module.settings.BooleanSetting;
import xipe.module.settings.ModeSetting;
import xipe.module.settings.NumberSetting;
import net.minecraft.client.MinecraftClient;

public class EntityFly extends Mod
{
    private static MinecraftClient mc;
    private Entity boat = null;
    
    public ModeSetting mode = new ModeSetting("Mode", "Bypass", "Bypass", "Static");
    public NumberSetting factor = new NumberSetting("Factor", 0, 5, 0.5, 0.1);
    public BooleanSetting rotate = new BooleanSetting("Rotate", false);
    
    public EntityFly() {
        super("EntityFly", "Allows flight if riding an entity", Category.EXPLOIT);
        addSettings(mode,factor,rotate);
    }
    
    @Override
    public void onTick() {
    	if(mode.isMode("Bypass")) {
    		if (EntityFly.mc.player != null && EntityFly.mc.player.hasVehicle()) {
    			final Entity vehicle = EntityFly.mc.player.getVehicle();
    			final Vec3d velocity = vehicle.getVelocity();
    			final double motionY = EntityFly.mc.options.jumpKey.isPressed() ? 0.5 : 0.0;
    			vehicle.setVelocity(new Vec3d(velocity.x, motionY, velocity.z));
        }	
    	}
    	if(mode.isMode("Static")) {
    	 boat = mc.player.getVehicle();
         if (boat != null) {
             Vec3d np = boat.getPos();
             float y = mc.player.getYaw();
             int mx = 0, my = 0, mz = 0;
             if (mc.options.jumpKey.isPressed())
                 my++;
             if (mc.options.backKey.isPressed())
                 mz++;
             if (mc.options.leftKey.isPressed())
                 mx--;
             if (mc.options.rightKey.isPressed())
                 mx++;
             if (mc.options.forwardKey.isPressed())
                 mz--;
             double ts = 1;
             double s = Math.sin(Math.toRadians(y));
             double c = Math.cos(Math.toRadians(y));
             double nx = ts * mz * s;
             double nz = ts * mz * -c;
             double ny = ts * my;
             nx += ts * mx * -c;
             nz += ts * mx * -s;
             Vec3d nv3 = new Vec3d(nx, ny, nz);
             np = np.add(nv3.multiply(factor.getValue() / 10));
             boat.updatePosition(np.x, np.y, np.z);
             boat.setVelocity(0, 0, 0);
             nv3 = nv3.multiply(0.1);
             boat.addVelocity(nv3.x, nv3.y, nv3.z);
         }
         if(rotate.isEnabled()) {
        	 boat.setYaw(mc.player.getYaw());
         }
    	}
        super.onTick();
    }
    
    @Override
    public void onDisable() {
        if (boat != null) {
            boat.setNoGravity(false);
        }
    }

    static {
        EntityFly.mc = MinecraftClient.getInstance();
    }
}

