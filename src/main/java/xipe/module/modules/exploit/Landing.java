package xipe.module.modules.exploit;

import net.minecraft.block.AirBlock;
import net.minecraft.item.BlockItem;
import net.minecraft.util.Hand;
import net.minecraft.util.hit.BlockHitResult;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Direction;
import net.minecraft.util.math.Vec3d;
import xipe.module.Mod;
import xipe.module.settings.NumberSetting;

public class Landing extends Mod{
	
	int blockSlot;
    int oldSlot;
    
    NumberSetting offset = new NumberSetting("Offset", 1, 5, 3, 1);

	public Landing() {
		super("Landing", "", Category.EXPLOIT);
		addSetting(offset);
	}
	
	   @Override
	    public void onEnable() {
	        oldSlot = mc.player.getInventory().selectedSlot;
	    }

	    @Override
	    public void onTick() {
	        if (!mc.player.isOnGround()) {

	            if (!(mc.player.getInventory().getStack(oldSlot).getItem() instanceof BlockItem)) {
	                for (int i = 0; i < 9; i++) {
	                    if (mc.player.getInventory().getStack(i).getItem() instanceof BlockItem) {
	                        blockSlot = i;
	                        break;
	                    }
	                }
	            } else blockSlot = mc.player.getInventory().selectedSlot;

	            if (blockSlot == -1) return;

	            BlockPos bp = new BlockPos(mc.player.getBlockPos().down().getX(), mc.player.getBlockPos().getY() - offset.getValue(), mc.player.getBlockPos().down().getZ());

	            if (mc.world.getBlockState(bp).getBlock() instanceof AirBlock) {

	                mc.player.getInventory().selectedSlot = blockSlot;

	                Vec3d vec = new Vec3d(bp.getX(), bp.getY(), bp.getZ());

	                mc.interactionManager.interactBlock(mc.player, Hand.MAIN_HAND, new BlockHitResult(
	                        vec, Direction.DOWN, bp, false
	                ));

	                mc.player.swingHand(Hand.MAIN_HAND);

	                mc.player.getInventory().selectedSlot = oldSlot;

	                toggle();
	            }
	        }
	    }

}
